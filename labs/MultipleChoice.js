function createCallback(n){return function(t,i){t?n.reject(t):n.resolve(i)}}var FreeResponse,Utils,Quizzes;(function(n){var i=function(){function n(n,t,i,r){var u=this;this.title=ko.observable(n);this.enabled=i?ko.computed(function(){return i()}):ko.computed(function(){return!0});this.visible=r?ko.computed(function(){return r()}):ko.computed(function(){return u.enabled()});this._clickHandler=t}return n.prototype.click=function(){this._clickHandler()},n}(),t;n.ControlButton=i;t=function(){function n(){this.title=ko.observable("Control Bar");this.leftButtons=ko.observableArray([]);this.rightButtons=ko.observableArray([])}return n}();n.ControlBarViewModel=t})(Quizzes||(Quizzes={})),function(n){function r(n){var u=n.question,t=[],i,r;return n.hints.forEach(function(n){t.push({id:null,isHint:!0,value:n.text})}),i={maxScore:0,timeLimit:0,hasAnswer:!1,answer:null,type:Labs.Components.InputComponentType,name:n.question,values:{hints:t},secure:!1,data:n},r={appVersion:{major:0,minor:1},components:[i],name:u,timeline:null,analytics:null},r}function o(){$(document).ready(function(){Labs.connect(function(n,i){if(n)ko.applyBindings({errorMessage:ko.observable(JSON.stringify(n)),view:ko.observable(new t("emptyTemplate",null))}),$("#errorModal").modal();else{var r=new e(i,{question:"",fontSize:"medium",hints:[],timeLimit:null});Utils.addCustomBindings();ko.applyBindings(r)}})})}var i=function(){function n(n){var t=this;this.question=ko.observable(n.question);this.fontSize=ko.observable(n.fontSize?n.fontSize:"medium");this.hints=ko.observableArray();n.hints.forEach(function(n){t.hints.push(new Quizzes.Hint(n))});this.serializedQuiz=ko.computed(function(){return{question:t.question(),fontSize:t.fontSize(),hints:ko.toJS(t.hints())}})}return n}(),t=function(){function n(n,t){this.template=n;this.viewModel=t}return n}(),u=function(){function n(n,t,i){var u=this;this.quiz=i;this._labEditor=t;this._appViewModel=n;this.initControlBar();i.serializedQuiz.subscribe(function(n){u._labEditor.setConfiguration(r(n),function(n){n&&u._appViewModel.showError(n)})})}return n.prototype.addHint=function(){this.quiz.hints.push(new Quizzes.Hint({text:""}))},n.prototype.removeHint=function(n){this.quiz.hints.splice(n,1)},n.prototype.resize=function(){},n.prototype.initControlBar=function(){var n=this;this.controlBar=new Quizzes.ControlBarViewModel;this.controlBar.leftButtons.push(new Quizzes.ControlButton("Preview",function(){n._appViewModel.switchMode(Labs.Core.LabMode.View,!0)},null,null))},n}(),f=function(){function n(n,t,r,u,f){var e=this,c,o,h,s;for(this.result=ko.observable(),this._appViewModel=n,this.quiz=new i(r.component.data),this._attempt=u,this._labInstance=t,c=$("<div/>").text(this.quiz.question()).html().replace(new RegExp("\r?\n","g"),"<br/>"),this.quizQuestionHtml=ko.observable(c),this.fontSize=ko.computed(function(){return"quiz-body-text-"+e.quiz.fontSize()}),this.submission=ko.observable(f?f:""),t.setState(this.submission(),function(n){n&&e._appViewModel.showError(n)}),this.submission.subscribe(function(n){t.setState(n,function(n){n&&e._appViewModel.showError(n)})}),this.result(this._attempt.getState()===Labs.ProblemState.Completed?"submitted":"inprogress"),o=u.getValues("hints"),h=0,s=0;s<o.length;s++)o[s].hasBeenRequested&&h++;this.currentHint=ko.observable(h);this.hints=ko.computed(function(){return e.quiz.hints().slice(0,e.currentHint())});this.hintState=ko.computed(function(){var n=e.quiz.hints().length>0?" ("+e.currentHint()+" of "+o.length+")":"";return"Hint"+n});this.isFinished=ko.computed(function(){return e.result()==="submitted"});this.resultMessages=ko.computed(function(){switch(e.result()){case"submitted":return["Submitted",""];default:return["",""]}});this.initControlBar()}return n.prototype.submit=function(){var n=this;this.result("submitted");this._attempt.submit(new Labs.Components.InputComponentAnswer(this.submission()),new Labs.Components.InputComponentResult(0,!0),function(t){t&&n._appViewModel.showError(t)})},n.prototype.done=function(){var n=this;Labs.getTimeline().next({},function(t){t&&(t.hasOwnProperty("code")&&t.code===7e3?$("#nextNotSupported").modal():n._appViewModel.showError(t))})},n.prototype.edit=function(){this._appViewModel.retry()},n.prototype.giveHint=function(){var n=this,t=this.currentHint();this._attempt.getValues("hints")[t].getValue(function(t){t&&n._appViewModel.showError(t)});this.currentHint(this.currentHint()+1)},n.prototype.initControlBar=function(){var n=this;this.controlBar=new Quizzes.ControlBarViewModel;this.controlBar.leftButtons.push(new Quizzes.ControlButton("Edit",function(){n._appViewModel.switchMode(Labs.Core.LabMode.Edit,!0)},function(){return n._appViewModel._isModeSetByAuthor()},null));this.controlBar.rightButtons.push(new Quizzes.ControlButton("Hint",function(){n.giveHint()},function(){return!n.isFinished()&&n.quiz.hints().length>n.currentHint()}));this.controlBar.rightButtons.push(new Quizzes.ControlButton("Submit",function(){n.submit()},function(){return!n.isFinished()&&n.submission().length>0},function(){return!n.isFinished()}));this.controlBar.rightButtons.push(new Quizzes.ControlButton("Edit",function(){n.edit()},function(){return n.isFinished()}));this.controlBar.rightButtons.push(new Quizzes.ControlButton("Continue",function(){n.done()},function(){return n.isFinished()}))},n}(),e=function(){function n(n,i){var r=this;this.errorMessage=ko.observable("");this._modeSwitchP=$.when();this.title=ko.observable("MainAppViewModel");this._defaultQuiz=i;this.view=ko.observable(new t("emptyTemplate",null));this._isModeSetByAuthor=ko.observable(!1);this.switchMode(n.mode,!1);Labs.on(Labs.Core.EventTypes.ModeChanged,function(n){var t=n;r.switchMode(Labs.Core.LabMode[t.mode],!1)})}return n.prototype.switchMode=function(n,t){var i=this;this._modeSwitchP=this._modeSwitchP.then(function(){var r=$.Deferred();return i._labInstance?i._labInstance.done(createCallback(r)):i._labEditor?i._labEditor.done(createCallback(r)):r.resolve(),r.promise().then(function(){return i._labEditor=null,i._labInstance=null,n===Labs.Core.LabMode.Edit?i.switchToEditMode(t):i.switchToShowMode(t)})});this._modeSwitchP.fail(function(n){i.showError(n)})},n.prototype.switchToEditMode=function(n){var f=this,e=$.Deferred();return Labs.editLab(createCallback(e)),e.promise().then(function(e){f._labEditor=e;var o=$.Deferred();return e.getConfiguration(createCallback(o)),o.promise().then(function(o){var s=$.Deferred(),h;return o?(h=new i(o.components[0].data),s.resolve()):(e.setConfiguration(r(f._defaultQuiz),createCallback(s)),h=new i(f._defaultQuiz)),f.view(new t("editTemplate",new u(f,e,h))),f._isModeSetByAuthor(n),s.promise()})})},n.prototype.switchToShowMode=function(n){var t=this,i=$.Deferred();return Labs.takeLab(createCallback(i)),i.promise().then(function(i){var r,u,f;return t._labInstance=i,r=t._labInstance.components[0],u=$.Deferred(),r.getAttempts(createCallback(u)),f=u.promise().then(function(n){var t=$.Deferred();return n.length>0?t.resolve(n[n.length-1]):r.createAttempt(createCallback(t)),t.then(function(n){var t=$.Deferred();return n.resume(createCallback(t)),t.promise().then(function(){return n})})}),t.resumeAndShowAttempt(f,r).then(function(){t._isModeSetByAuthor(n)})})},n.prototype.createAndShowNewAttempt=function(){var n=this._labInstance.components[0],t=$.Deferred(),i;return n.createAttempt(createCallback(t)),i=t.then(function(n){var t=$.Deferred();return n.resume(createCallback(t)),t.promise().then(function(){return n})}),this.resumeAndShowAttempt(i,n)},n.prototype.resumeAndShowAttempt=function(n,i){var r=this,u=$.Deferred();return this._labInstance.getState(createCallback(u)),$.when(n,u.promise()).then(function(n,u){var e=$.Deferred();return r.view(new t("showTemplate",new f(r,r._labInstance,i,n,u))),e.resolve().promise()})},n.prototype.retry=function(){var n=this;this.createAndShowNewAttempt().fail(function(t){n.showError(t)})},n.prototype.showError=function(n){this.errorMessage(JSON.stringify(n));$("#errorModal").modal()},n}();n.initialize=o}(FreeResponse||(FreeResponse={})),function(n){var t=function(){function n(n){this.id=ko.observable(n.id);this.choice=ko.observable(n.choice);this.feedback=ko.observable(n.feedback)}return n.prototype.removeFeedback=function(){this.feedback(null)},n.prototype.addFeedback=function(){this.feedback("")},n}();n.Choice=t}(Quizzes||(Quizzes={})),function(n){var t=function(){function t(t){var i=this;this.question=ko.observable(t.question);this.fontSize=ko.observable(t.fontSize?t.fontSize:"medium");this.choices=ko.observableArray();t.choices.forEach(function(t){i.choices.push(new n.Choice(t))});this.hasAnswer=ko.observable(t.hasAnswer==null?!0:t.hasAnswer);this.answer=ko.observableArray(t.answer instanceof Array?t.answer:[t.answer]);this.required=ko.observable(t.required);this.hints=ko.observableArray();t.hints.forEach(function(t){i.hints.push(new n.Hint(t))});this.limitAttempts=ko.observable(t.limitAttempts);this.maxAttempts=ko.observable(t.maxAttempts).extend({minNumber:1});this.shuffleChoices=ko.observable(t.shuffleChoices);this.isTimed=ko.observable(t.isTimed);this.timeLimit=ko.observable(t.timeLimit);this.allowChoiceEditing=ko.observable(t.allowChoiceEditing);this.allowMultipleAnswers=ko.observable(t.allowMultipleAnswers);this.multipleAnswerOption=ko.computed({read:function(){return i.allowMultipleAnswers()?"multiple":"single"},write:function(n){i.allowMultipleAnswers(n==="multiple"?!0:!1)}});this.serializedQuiz=ko.computed(function(){var n;return n=i.hasAnswer?i.allowMultipleAnswers()?i.answer():i.answer()[0]:null,{question:i.question(),fontSize:i.fontSize(),choices:ko.toJS(i.choices()),hasAnswer:i.hasAnswer(),answer:ko.toJS(n),required:i.required(),hints:ko.toJS(i.hints()),limitAttempts:i.limitAttempts(),maxAttempts:i.maxAttempts(),shuffleChoices:i.shuffleChoices(),isTimed:i.isTimed(),timeLimit:i.timeLimit(),allowMultipleAnswers:i.allowMultipleAnswers(),allowChoiceEditing:i.allowChoiceEditing()}})}return t}();n.Quiz=t}(Quizzes||(Quizzes={})),function(n){var t=function(){function n(n){this.text=ko.observable(n.text)}return n}();n.Hint=t}(Quizzes||(Quizzes={})),function(n){function u(n){for(var i,r,t=0;t<n.length;t++)i=Math.floor(Math.random()*(n.length-t)),r=n[t],n[t]=n[i+t],n[i+t]=r;return n}function f(){return(new Date).getTime()/1e3}function e(n,t){return t.keyCode!==13}function t(){ko.bindingHandlers.focusOnInit={init:function(n){$(n).focus()}}}function i(){ko.bindingHandlers.fade={init:function(n){$(n).hide()},update:function(n){setTimeout(function(){$(n).hide({duration:0,done:function(){$(n).fadeIn()}})})}}}function r(){ko.extenders.minNumber=function(n,t){var i=ko.computed({read:n,write:function(i){var r;if(typeof i=="string")r=Math.floor(parseInt(i)),r=isNaN(r)?t:r;else if(typeof i=="number")r=Math.floor(i);else throw"unexpected data type in MinNumberExtender: "+i;r<t&&(r=t);n(r);n.notifySubscribers(r)}}).extend({notify:"always"});return i(n()),i}}function o(){t();i();r()}n.shuffle=u;n.getTimeInSeconds=f;n.filterKeys=e;n.addFocusOnInitBinding=t;n.addFadeBinding=i;n.addMinNumberExtender=r;n.addCustomBindings=o}(Utils||(Utils={}));ko.bindingHandlers.popover={init:function(n){$(n).popover();$(n).on("click",function(n){return n.preventDefault(),!0})}},function(n){function i(n){var i=[],t,r;return n.choices.forEach(function(n){i.push({id:n.id.toString(),name:n.choice,value:n.choice})}),t=[],n.hints.forEach(function(n){t.push({id:null,isHint:!0,value:n.text})}),r={name:n.question,type:Labs.Components.ChoiceComponentType,timeLimit:n.isTimed?n.timeLimit:0,maxAttempts:n.limitAttempts?n.maxAttempts:0,choices:i,maxScore:1,hasAnswer:n.hasAnswer?!0:!1,answer:n.allowMultipleAnswers?n.answer:n.answer!=null?[n.answer]:[],values:{hints:t},secure:!1,data:n},{appVersion:{major:0,minor:1},components:[r],name:n.question,timeline:null,analytics:null}}function o(n){$(document).ready(function(){Labs.connect(function(i,r){if(i)ko.applyBindings({errorMessage:ko.observable(JSON.stringify(i)),view:ko.observable(new t("emptyTemplate",null))}),$("#errorModal").modal();else{var u=new e(r,n);Utils.addCustomBindings();ko.applyBindings(u)}})})}var t=function(){function n(n,t){this.template=n;this.viewModel=t}return n}(),r=function(){function t(n,t,r){var u=this;this._appViewModel=n;this.quiz=r;this._labEditor=t;this.initControlBar();r.allowMultipleAnswers.subscribe(function(n){!n&&r.answer().length>1&&r.answer([r.answer()[0]])});r.serializedQuiz.subscribe(function(n){u._labEditor.setConfiguration(i(n),function(n){n&&u._appViewModel.showError(n)})})}return t.prototype.addChoice=function(){var t=0;this.quiz.choices().forEach(function(n){var i=n.id();t=Math.max(i,t)});this.quiz.choices.push(new n.Choice({id:t+1,choice:null,feedback:null}))},t.prototype.removeChoice=function(n){var t=this.quiz.choices(),i=t[n].id();this.quiz.answer.remove(i.toString());this.quiz.choices.splice(n,1)},t.prototype.addHint=function(){this.quiz.hints.push(new n.Hint({text:""}))},t.prototype.removeHint=function(n){this.quiz.hints.splice(n,1)},t.prototype.flipAnswer=function(n){var i=n.toString(),t=this.quiz.choices()[n].id().toString();if(this.quiz.allowMultipleAnswers())this.quiz.answer.indexOf(t)>=0?this.quiz.answer.remove(t):this.quiz.answer.push(t);else{if(this.quiz.answer.indexOf(t)>=0)return;this.quiz.answer.removeAll();this.quiz.answer.push(t)}},t.prototype.isAnswer=function(n){var t=this.quiz.choices()[n].id().toString();return this.quiz.answer.indexOf(t)!=-1},t.prototype.initControlBar=function(){var t=this;this.controlBar=new n.ControlBarViewModel;this.controlBar.leftButtons.push(new n.ControlButton("Preview",function(){t._appViewModel.switchMode(Labs.Core.LabMode.View,!0)},null))},t}(),u=function(){function n(n,t){var i=n.id();this.showFeedback=ko.observable(t.some(function(n){return i===n}));this.choice=n}return n}(),f=function(){function t(t,i,r,f,e){var o=this,s,v,y,h,c,p,l,w,a,b,k;for(this._appViewModel=t,this.quiz=new n.Quiz(r.component.data),this._attempt=f,this._labInstance=i,this.fontSize=ko.computed(function(){return"quiz-body-text-"+o.quiz.fontSize()}),s=e?e.data:null,v=s?s.seed:Math.seedrandom(),Math.seedrandom(v),this._seed=ko.observable(v),this.submission=ko.observableArray(),s&&this.submission(s.submission),this.submitEnabled=ko.computed(function(){var n=o.submission(),t=o.quiz.allowMultipleAnswers();return t||n.length>0}),y=s?s.feedbackChoices:[],this._feedbackChoices=ko.observableArray(y),this._labState=ko.computed(function(){return{seed:o._seed(),submission:o.submission(),feedbackChoices:o._feedbackChoices()}}),i.setState(this._labState(),function(n){n&&o._appViewModel.showError(n)}),this._labState.subscribe(function(n){i.setState(n,function(n){n&&o._appViewModel.showError(n)})}),h=f.getSubmissions(),this.result=ko.observable(),this.result.extend({notify:"always"}),c=this._attempt.getState(),c===Labs.ProblemState.Timeout?this.result("timeout"):h.length>0&&(p=h[h.length-1],this.submission(p.answer.answer),this.quiz.hasAnswer()?this.result(p.result.score===1?"correct":"incorrect"):this.result("submitted")),l=f.getValues("hints"),w=0,a=0;a<l.length;a++)l[a].hasBeenRequested&&w++;this.currentHint=ko.observable(w);this.choices=ko.computed(function(){var t=o.quiz.choices(),n=[];return t.forEach(function(t){return n.push(new u(t,y))}),o.quiz.shuffleChoices()?Utils.shuffle(n):n});this.hints=ko.computed(function(){return o.quiz.hints().slice(0,o.currentHint())});this.hintState=ko.computed(function(){var n=o.quiz.hints().length>0?" ("+o.currentHint()+" of "+l.length+")":"";return"Hint"+n});b=h.length;this.attemptsMade=ko.observable(b);this.attemptsRemaining=ko.computed(function(){return o.quiz.maxAttempts()-o.attemptsMade()});this.timeRemaining=ko.observable(c!==Labs.ProblemState.Timeout?this.quiz.timeLimit():0);this.timeRemainingFormatted=ko.computed(function(){var n=o.timeRemaining();return moment(n*1e3).format("mm:ss")});this.isFinished=ko.computed(function(){var n=o.result()==="correct",t=o.result()==="timeout",i=o.result()==="submitted",r=o.quiz.limitAttempts()&&o.attemptsRemaining()===0||!o.quiz.limitAttempts()&&n;return n||r||t||i});this.isFinished.subscribe(function(n){n&&o.intervalId&&(clearInterval(o.intervalId),o.intervalId=null)});this.resultMessages=ko.computed(function(){switch(o.result()){case"correct":return["Correct","Great Job!"];case"incorrect":return["Incorrect","Please try again"];case"timeout":return["Time Expired",""];case"submitted":return["Submitted",""];default:return["",""]}});this.selectAnswerMessage=ko.computed(function(){return o.quiz.hasAnswer()?o.quiz.allowMultipleAnswers()?"Select one or more answers":"Select the correct answer":o.quiz.allowMultipleAnswers()?"Select one or more options":"Select one option"});c===Labs.ProblemState.InProgress&&this.quiz.isTimed()&&(k=Utils.getTimeInSeconds(),this.intervalId=setInterval(function(){var t=Utils.getTimeInSeconds(),i=t-k,n=Math.ceil(o.quiz.timeLimit()-i);n<=0&&(clearInterval(o.intervalId),o.intervalId=null,o.result("timeout"),o._attempt.timeout(function(){}));o.timeRemaining(n)},1e3));this.initControlBar()}return t.prototype.validateSubmission=function(n,t){return n.length!=t.length?!1:n.every(function(n){return t.indexOf(n)!=-1})},t.prototype.initControlBar=function(){var t=this;this.controlBar=new n.ControlBarViewModel;this.controlBar.leftButtons.push(new n.ControlButton("Edit",function(){t._appViewModel.switchMode(Labs.Core.LabMode.Edit,!1)},function(){return t._appViewModel._isModeSetByAuthor()}));this.controlBar.rightButtons.push(new n.ControlButton("Hint",function(){t.giveHint()},function(){return!t.isFinished()&&t.quiz.hints().length>t.currentHint()}));this.controlBar.rightButtons.push(new n.ControlButton("Submit",function(){t.submit()},function(){return!t.isFinished()&&t.submitEnabled()},function(){return!t.isFinished()}));this.quiz.hasAnswer()?this.controlBar.rightButtons.push(new n.ControlButton("Retry",function(){t.retry()},function(){return t.isFinished()})):this.controlBar.rightButtons.push(new n.ControlButton("Edit",function(){t.retry()},function(){return t.isFinished()}));this.controlBar.rightButtons.push(new n.ControlButton("Continue",function(){t.done()},function(){return t.isFinished()}))},t.prototype.submit=function(){var i=this,n=this.submission(),u=this.quiz.answer(),f=this.choices(),t,r;n=n.slice(0);this.quiz.hasAnswer()?(t=this.validateSubmission(n,u),this.result(t?"correct":"incorrect")):this.result("submitted");n.forEach(function(n){f.forEach(function(t){t.choice.feedback()!=null&&t.choice.id().toString()===n&&(t.showFeedback()||(t.showFeedback(!0),i._feedbackChoices.push(t.choice.id())))})});this.attemptsMade(this.attemptsMade()+1);r=t||this.quiz.limitAttempts()&&this.attemptsRemaining()===0;this._attempt.submit(new Labs.Components.ChoiceComponentAnswer(n),new Labs.Components.ChoiceComponentResult(t?1:0,r),function(n){n&&i._appViewModel.showError(n)})},t.prototype.done=function(){var n=this;Labs.getTimeline().next({},function(t){t&&(t.hasOwnProperty("code")&&t.code===7e3?$("#nextNotSupported").modal():n._appViewModel.showError(t))})},t.prototype.giveHint=function(){var n=this,t=this.currentHint();this._attempt.getValues("hints")[t].getValue(function(t){t&&n._appViewModel.showError(t)});this.currentHint(this.currentHint()+1)},t.prototype.flipFeedback=function(n){var t=this.choices()[n];t.choice.feedback()!=null&&(t.showFeedback()?(t.showFeedback(!1),this._feedbackChoices.remove(t.choice.id())):(t.showFeedback(!0),this._feedbackChoices.push(t.choice.id())))},t.prototype.retry=function(){this._appViewModel.retry()},t.prototype.flipSelection=function(n){this.isFinished()||this.setSelection(n,!this.isSelected(n))},t.prototype.isSelected=function(n){var t=this.choices()[n].choice.id().toString();return this.submission.indexOf(t)!=-1},t.prototype.setSelection=function(n,t){if(!this.isFinished()){var i=this.choices()[n].choice.id().toString();t?(this.quiz.allowMultipleAnswers()||this.submission.removeAll(),this.submission.indexOf(i)==-1&&this.submission.push(i)):this.submission.remove(i)}},t}(),e=function(){function u(n,i){var r=this;this.errorMessage=ko.observable("");this._modeSwitchP=$.when();this._defaultQuiz=i;this.view=ko.observable(new t("emptyTemplate",null));this._isModeSetByAuthor=ko.observable(!1);this.switchMode(n.mode,!1);Labs.on(Labs.Core.EventTypes.ModeChanged,function(n){var t=n;r.switchMode(Labs.Core.LabMode[t.mode],!1)})}return u.prototype.switchMode=function(n,t){var i=this;this._modeSwitchP=this._modeSwitchP.then(function(){var r=$.Deferred();return i._labInstance?i._labInstance.done(createCallback(r)):i._labEditor?i._labEditor.done(createCallback(r)):r.resolve(),r.promise().then(function(){return i._labEditor=null,i._labInstance=null,n===Labs.Core.LabMode.Edit?i.switchToEditMode(t):i.switchToShowMode(t)})});this._modeSwitchP.fail(function(n){i.showError(n)})},u.prototype.switchToEditMode=function(u){var f=this,e=$.Deferred();return Labs.editLab(createCallback(e)),e.promise().then(function(e){f._labEditor=e;var o=$.Deferred();return e.getConfiguration(createCallback(o)),o.promise().then(function(o){var s=$.Deferred(),h;return o?(h=new n.Quiz(o.components[0].data),s.resolve()):(e.setConfiguration(i(f._defaultQuiz),createCallback(s)),h=new n.Quiz(f._defaultQuiz)),f.view(new t("editTemplate",new r(f,e,h))),f._isModeSetByAuthor(u),s.promise()})})},u.prototype.switchToShowMode=function(n){var t=this,i=$.Deferred();return Labs.takeLab(createCallback(i)),i.promise().then(function(i){var r,u,f;return t._labInstance=i,r=t._labInstance.components[0],u=$.Deferred(),r.getAttempts(createCallback(u)),f=u.promise().then(function(n){var t=$.Deferred();return n.length>0?t.resolve(n[n.length-1]):r.createAttempt(createCallback(t)),t.then(function(n){var t=$.Deferred();return n.resume(createCallback(t)),t.promise().then(function(){return n})})}),t.resumeAndShowAttempt(f,r).then(function(){t._isModeSetByAuthor(n)})})},u.prototype.crateAndShowNewAttempt=function(){var n=this._labInstance.components[0],t=$.Deferred(),i;return n.createAttempt(createCallback(t)),i=t.then(function(n){var t=$.Deferred();return n.resume(createCallback(t)),t.promise().then(function(){return n})}),this.resumeAndShowAttempt(i,n)},u.prototype.resumeAndShowAttempt=function(n,i){var r=this,u=$.Deferred();return this._labInstance.getState(createCallback(u)),$.when(n,u.promise()).then(function(n,u){var e=$.Deferred();return r.view(new t("showTemplate",new f(r,r._labInstance,i,n,u))),e.resolve().promise()})},u.prototype.retry=function(){var n=this;this.crateAndShowNewAttempt().fail(function(t){n.showError(t)})},u.prototype.showError=function(n){this.errorMessage(JSON.stringify(n));$("#errorModal").modal()},u}();n.initialize=o}(Quizzes||(Quizzes={}))